<main class="max-w-7xl mx-auto p-4 sm:p-6 space-y-6">

  <!-- Migas de pan -->
  <nav class="text-sm text-gray-500 mb-4" aria-label="Breadcrumb">
    <ol class="list-reset flex space-x-2">
      <li>
        <a href="/recetas" class="hover:underline text-emerald-600">Recetas</a>
        <span class="mx-2">/</span>
      </li>
      <li class="text-gray-500">Papelera</li>
    </ol>
  </nav>

  <!-- Encabezado -->
  <div class="flex justify-between items-center mb-4">
    <h1 class="text-2xl sm:text-3xl font-bold text-gray-800">Papelera</h1>
    <a href="/recetas"
      class="bg-blue-100 text-blue-700 font-medium px-4 py-2 rounded-lg hover:bg-blue-200 transition flex items-center gap-2">
      <i class="fas fa-arrow-left"></i> Regresar
    </a>
  </div>

  <!-- Filtros -->
  <div class="bg-white p-4 rounded-lg shadow-sm border">
    <form id="filtro-papelera-form" method="GET" action="/recetas/papelera"
      class="flex flex-col md:flex-row items-center gap-4">

      <!-- Buscador Principal por Nombre -->
      <div class="relative flex-grow w-full md:w-auto">
        <span class="absolute inset-y-0 left-0 flex items-center pl-3">
          <i class="fas fa-search text-gray-400"></i>
        </span>
        <input id="buscar-nombre-input" type="text" name="q" placeholder="Buscar por nombre..."
          value="<%= busquedaNombre || '' %>"
          class="w-full pl-10 pr-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-500 transition">
      </div>

      <!-- Filtro por Categoría -->
      <div class="relative w-full md:w-auto">
        <select name="categoria"
          class="w-full appearance-none bg-gray-50 border rounded-lg px-4 py-2 pr-8 focus:outline-none focus:ring-2 focus:ring-emerald-500 transition">
          <option value="">Todas las Categorías</option>
          <% categorias.forEach(cat=> { %>
            <option value="<%= cat %>" <%=busquedaCategoria===cat ? 'selected' : '' %>><%= cat %>
            </option>
            <% }) %>
        </select>
        <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700">
          <i class="fas fa-chevron-down text-xs"></i>
        </div>
      </div>

      <!-- Filtro por Etiqueta -->
      <div class="relative w-full md:w-auto">
        <select name="etiqueta"
          class="w-full appearance-none bg-gray-50 border rounded-lg px-4 py-2 pr-8 focus:outline-none focus:ring-2 focus:ring-emerald-500 transition">
          <option value="">Todas las Etiquetas</option>
          <% etiquetas.forEach(et=> { %>
            <option value="<%= et %>" <%=busquedaEtiqueta===et ? 'selected' : '' %>><%= et %>
            </option>
            <% }) %>
        </select>
        <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700">
          <i class="fas fa-chevron-down text-xs"></i>
        </div>
      </div>

      <!-- Botón para limpiar filtros -->
      <a href="/recetas/papelera"
        class="text-sm text-gray-600 hover:text-emerald-600 whitespace-nowrap px-3 py-2 rounded-lg hover:bg-gray-100 transition">Limpiar</a>

    </form>
  </div>


  <!-- Tabla -->
  <% if (recetas.length===0) { %>
    <div class="text-center py-16">
      <i class="fas fa-ghost text-4xl text-gray-300 mb-4"></i>
      <p class="text-gray-500">No hay recetas en la papelera que coincidan con tu búsqueda.</p>
    </div>
    <% } else { %>
      <div class="overflow-x-auto bg-white border rounded shadow-sm mt-4">
        <table class="min-w-full table-auto text-sm text-gray-700">
          <thead class="bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase">
            <tr>
              <th class="px-6 py-3">Categoría</th>
              <th class="px-6 py-3">Nombre</th>
              <th class="px-6 py-3">Imagen</th>
              <th class="px-6 py-3 text-right">Acciones</th>
            </tr>
          </thead>
          <tbody>
            <% recetas.forEach(r=> { %>
              <tr class="border-b hover:bg-gray-50">
                <td class="px-6 py-4 font-medium">
                  <%= r.categoria || 'Sin categoría' %>
                </td>
                <td class="px-6 py-4">
                  <%= r.titulo %>
                </td>
                <td class="px-6 py-4">
                  <% if (r.imagen) { %>
                    <img src="<%= r.imagen %>" alt="Imagen" class="w-12 h-12 object-cover rounded shadow">
                    <% } else { %>
                      <span class="text-gray-400">Sin imagen</span>
                      <% } %>
                </td>
                <td class="px-6 py-4 text-right">
                  <% if (user && (String(r.usuario_id || r.usuarioId)===String(user.id) || user.rol==='admin' )) { %>
                    <div class="inline-flex items-center gap-2 justify-end">
                      <form action="/recetas/restaurar/<%= r.id %>" method="POST"
                        onsubmit="return confirm('¿Deseas restaurar esta receta?')">
                        <button type="submit"
                          class="text-green-700 hover:text-green-900 text-sm font-medium px-2 py-1 rounded hover:bg-green-100 transition"
                          title="Restaurar">
                          <i class="fas fa-undo"></i>
                        </button>
                      </form>
                      <form action="/recetas/eliminar-definitivo/<%= r.id %>" method="POST"
                        onsubmit="return confirm('¿Eliminar permanentemente esta receta?')">
                        <button type="submit"
                          class="text-red-600 hover:text-red-800 text-sm font-medium px-2 py-1 rounded hover:bg-red-100 transition"
                          title="Eliminar definitivamente">
                          <i class="fas fa-trash-alt"></i>
                        </button>
                      </form>
                    </div>
                    <% } else { %>
                      <span class="text-gray-400 italic text-sm">Solo lectura</span>
                      <% } %>
                </td>
              </tr>
              <% }) %>
          </tbody>
        </table>
      </div>
      <% } %>
</main>


<script>
  document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('filtro-papelera-form');
    form.querySelectorAll('select').forEach(select => {
      select.addEventListener('change', () => {
        form.submit();
      });
    });
  });
</script>