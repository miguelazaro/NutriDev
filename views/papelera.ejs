<main class="max-w-7xl mx-auto p-4 sm:p-6 space-y-6">

  <!-- Migas de pan -->
  <nav class="text-sm text-gray-500 mb-4" aria-label="Breadcrumb">
    <ol class="list-reset flex space-x-2">
      <li>
        <a href="/recetas" class="hover:underline text-emerald-600">Recetas</a>
        <span class="mx-2">/</span>
      </li>
      <li class="text-gray-500">Papelera</li>
    </ol>
  </nav>

  <!-- Encabezado -->
  <div class="flex justify-between items-center">
    <h1 class="text-2xl sm:text-3xl font-bold text-gray-800">Papelera</h1>
    <a href="/recetas"
      class="bg-blue-100 text-blue-700 font-medium px-4 py-2 rounded hover:bg-blue-200 transition flex items-center gap-2">
      <i class="fas fa-arrow-left"></i> Regresar
    </a>
  </div>

  <!-- Filtros -->
  <form method="GET" action="/papelera" class="grid grid-cols-1 md:grid-cols-3 gap-3 mt-4">
    <select name="categoria" class="border rounded px-3 py-2">
      <option value="">Buscar por Categoría</option>
      <% categorias.forEach(cat => { %>
        <option value="<%= cat %>" <%= busquedaCategoria === cat ? 'selected' : '' %>><%= cat %></option>
      <% }) %>
    </select>

    <input type="text" name="q" placeholder="Buscar por nombre" value="<%= busquedaNombre || '' %>"
      class="border rounded px-3 py-2">

    <select name="etiqueta" class="border rounded px-3 py-2">
      <option value="">Buscar por Etiqueta</option>
      <% etiquetas.forEach(et => { %>
        <option value="<%= et %>" <%= busquedaEtiqueta === et ? 'selected' : '' %>><%= et %></option>
      <% }) %>
    </select>

    <div class="md:col-span-3 text-right">
      <button type="submit" class="bg-emerald-600 text-white px-4 py-2 rounded hover:bg-emerald-700 transition">
        <i class="fas fa-search"></i> Buscar
      </button>
    </div>
  </form>

  <!-- Tabla -->
  <% if (recetas.length === 0) { %>
    <p class="text-center text-gray-500 py-10">No hay recetas en la papelera.</p>
  <% } else { %>
    <div class="overflow-x-auto bg-white border rounded shadow-sm mt-4">
      <table class="min-w-full table-auto text-sm text-gray-700">
        <thead class="bg-gray-100 text-left text-xs font-semibold text-gray-600 uppercase">
          <tr>
            <th class="px-6 py-3">Categoría</th>
            <th class="px-6 py-3">Nombre</th>
            <th class="px-6 py-3">Imagen</th>
            <th class="px-6 py-3 text-right">Acciones</th>
          </tr>
        </thead>
        <tbody>
          <% recetas.forEach(r => { %>
            <tr class="border-b hover:bg-gray-50">
              <td class="px-6 py-4 font-medium"><%= r.categoria || 'Sin categoría' %></td>
              <td class="px-6 py-4"><%= r.titulo %></td>
              <td class="px-6 py-4">
                <% if (r.imagen) { %>
                  <img src="<%= r.imagen %>" alt="Imagen" class="w-12 h-12 object-cover rounded shadow">
                <% } else { %>
                  <span class="text-gray-400">Sin imagen</span>
                <% } %>
              </td>
              <td class="px-6 py-4 text-right">
                <% if (user && (String(r.usuario_id || r.usuarioId) === String(user.id) || user.rol === 'admin')) { %>
                  <div class="inline-flex items-center gap-2 justify-end">
                    <form action="/recetas/restaurar/<%= r.id %>" method="POST"
                      onsubmit="return confirm('¿Deseas restaurar esta receta?')">
                      <button type="submit"
                        class="text-green-700 hover:text-green-900 text-sm font-medium px-2 py-1 rounded hover:bg-green-100 transition"
                        title="Restaurar">
                        <i class="fas fa-undo"></i>
                      </button>
                    </form>
                    <form action="/recetas/eliminar-definitivo/<%= r.id %>" method="POST"
                      onsubmit="return confirm('¿Eliminar permanentemente esta receta?')">
                      <button type="submit"
                        class="text-red-600 hover:text-red-800 text-sm font-medium px-2 py-1 rounded hover:bg-red-100 transition"
                        title="Eliminar definitivamente">
                        <i class="fas fa-trash-alt"></i>
                      </button>
                    </form>
                  </div>
                <% } else { %>
                  <span class="text-gray-400 italic text-sm">Solo lectura</span>
                <% } %>
              </td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
  <% } %>
</main>
